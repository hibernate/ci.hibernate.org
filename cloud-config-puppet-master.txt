#cloud-config
package_update: true
package_upgrade: true
package_reboot_if_required: true

packages:
 - git
 - puppet
 - puppet-server
 - sendmail

manage_etc_hosts: false
 
runcmd:
 - [ setenforce, 0 ]
 - [ sh, -xc, "mv /etc/puppet /etc/puppet.bak" ]
 - [ git, clone, "git://github.com/hibernate/ci.hibernate.org", /etc/puppet, --depth, 1, --recurse-submodules ]
 - [ sh, -xc, "echo '127.0.0.1 puppet' >> /etc/hosts" ]
 - [ service, puppetmaster, start ]
 - [ puppet, agent, --onetime, --no-daemonize, --waitforcert, 10 ]

disable_root: false
final_message: "Cloud-init v. ${version} finished setting up the Hibernate CI system! Up after ${uptime} seconds."

